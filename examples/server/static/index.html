<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com" />
    <title>Watercolor â€“ Demo</title>
    <link rel="icon" href="favicon.ico" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.4.3/css/bulma.min.css" integrity="sha256-VC9bpAao257nf22leBRLU7AqKGwS9/Ylz8hfpHmOob4=" crossorigin="anonymous" />
    <link rel="stylesheet" href="css/style.css" />

<script type="application/x-worker" id="worker">
importScripts('http://localhost:8000/js/watercolor.min.js')

const { OffscreenCanvas, Watercolor, close, postMessage } = this

// polyfill
Object.defineProperty(OffscreenCanvas.prototype, 'toBlob', {
  configurable: true,
  value: OffscreenCanvas.prototype.toBlob || OffscreenCanvas.prototype.convertToBlob,
  writable: true
})

this.addEventListener('message', async function (event) {
  const canvas = event.data.canvas
  const config = Object.assign({{config}}, { canvas })

  postMessage({ type: 'size', width: config.width, height: config.height })

  const watercolor = new Watercolor(config)

  await watercolor.process()
  await watercolor.context.commit()

  const blob = await canvas.toBlob()

  postMessage({ type: 'data', blob })

  close()
})
</script>

  </head>
  <body>
    <nav class="navbar">
      <div class="navbar-brand">
        <a class="navbar-item">
          <img src="img/logo.png" alt="canvas-watercolor" width="28" height="28">
          <h1 class="title">Watercolor</h1>
        </a>
      </div>
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/patrickroberts/canvas-watercolor" target="_blank">
          <span class="icon is-large">
            <i class="fa fa-github"></i>
          </span>
        </a>
      </div>
    </nav>
    <section class="hero is-dark is-bold">
      <div class="hero-body">
        <p class="title">Watercolor allRGB</p>
        <p class="subtitle">Demo</p>
      </div>
    </section>
    <section class="section">
      <div class="columns is-multiline">
        <div class="column is-narrow">
          <div class="field">
            <label class="label">Canvas</label>
            <div class="control">
              <canvas width="256" height="128" id="watercolor"></canvas>
            </div>
          </div>
        </div>
        <div class="column">
          <div class="field">
            <label class="label">Configuration</label>
            <div class="control">

<textarea class="textarea" rows="13" id="configuration">{
  width: 256, // px
  height: 128, // px
  depth: 5, // 1 - 8
  priority: 1, // 0 - 8
  select: 'min', // 'min', 'max', 'median', 'average'
  weights: 'natural', // 'default', 'natural', [.2126, .7152, .0722]
  focus: [0, 0], // [%, %]
  interval: 30, // ms
  sort: (c1, c2) => c1.r - c2.r + (c1.g - c2.g) / 3 + c2.b - c1.b,
  shuffle: false, // true, false
  seed: 123456789
}</textarea>

            </div>
          </div>
          <div class="field">
            <div class="control">
              <button class="button is-dark" id="generate">Generate</button>
            </div>
          </div>
        </div>
      </div>
    </section>
    <script src="js/app.js"></script>
  </body>
</html>
