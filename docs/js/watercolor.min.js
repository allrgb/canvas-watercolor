!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Watercolor=t()}}(function(){return function t(e,n,i){function r(s,c){if(!n[s]){if(!e[s]){var u="function"==typeof require&&require;if(!c&&u)return u(s,!0);if(o)return o(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var a=n[s]={exports:{}};e[s][0].call(a.exports,function(t){var n=e[s][1][t];return r(n||t)},a,a.exports,t,e,n,i)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)r(i[s]);return r}({1:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});class i{constructor(t,e,n,i){const r=8-i,o=Math.max(0,1<<r-1);this.r=(t<<r)+o,this.g=(e<<r)+o,this.b=(n<<r)+o}compare([t,e,n],[i,r,o]=[1,1,1]){const{r:s,g:c,b:u}=this,l=(s-t)*i,a=(c-e)*r,h=(u-n)*o;return l*l+a*a+h*h}}n.default=i},{}],2:[function(t,e,n){"use strict";var i=function(t){return t&&t.__esModule?t:{default:t}}(t("./watercolor"));e.exports=i.default},{"./watercolor":5}],3:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});class i{static memoized(t,e,n,r){class o extends i{constructor(t,e){if(super(t,e),this.index>=0){if(this.cache.has(this.index))return this.cache.get(this.index);this.cache.set(this.index,this)}}}return Object.defineProperties(o.prototype,{cache:{configurable:!0,value:new Map,writable:!0},width:{configurable:!0,value:n,writable:!0},height:{configurable:!0,value:r,writable:!0}}),new o(t,e)}constructor(t,e){if(t<0||t>=this.width||e<0||e>=this.height)return this.x=-1,this.y=-1,void(this.index=-1);this.x=t,this.y=e,this.index=e*this.width+t<<2}get neighbors(){const{x:t,y:e,constructor:n}=this,i=[new n(t-1,e-1),new n(t,e-1),new n(t+1,e-1),new n(t-1,e),new n(t+1,e),new n(t-1,e+1),new n(t,e+1),new n(t+1,e+1)].filter(t=>t.index>=0);return Object.defineProperty(this,"neighbors",{configurable:!0,value:i,writable:!0}),i}}n.default=i},{}],4:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.compare=function(t,e,n){return(n.count>=t)-(e.count>=t)||e.distance-n.distance};n.select={min:Function.prototype.apply.bind(Math.min,Math),max:Function.prototype.apply.bind(Math.max,Math),average(t){let e=0;for(let n=t.length-1;n>=0;n--)e+=t[n];return e/t.length},median(t){t.sort((t,e)=>t-e);const e=t.length>>1;return t.length%2==1?t[e]:(t[e]+t[e-1])/2}},n.weights={default:[1,1,1],natural:[2126,7152,722]}},{}],5:[function(t,e,n){(function(e,i){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(n,"__esModule",{value:!0});var o=r(t("./color")),s=r(t("./pixel")),c=t("./utils");const{OffscreenCanvas:u,performance:l}=i;class a{constructor({canvas:t,width:e=t.width,height:n=t.height,depth:i=Math.round(Math.log2(e*n)/3),priority:r=0,select:h=a.select.min,weights:f=a.weights.default,focus:d=[50,50],interval:p=1e3,sort:g,shuffle:w=!1}={}){if(!(t instanceof u))throw new TypeError("canvas must be instance of OffscreenCanvas");this.width=t.width=e,this.height=t.height=n,this.priority=r,this.select="function"==typeof h?h:a.select[h],this.weights=Array.isArray(f)?f:a.weights[f];const m=Math.min(Math.max(Math.round(d[0]*(e-1)/100),0),e-1),y=Math.min(Math.max(Math.round(d[1]*(n-1)/100),0),n-1);this.focus=[m,y],this.interval=p,this.context=t.getContext("2d"),this.colors=[],this.process=this.process.bind(this,s.default,c.compare,l,Math.random);const b=i,x=1<<b;for(let t=0;t<x;t++)for(let e=0;e<x;e++)for(let n=0;n<x;n++)this.colors[this.colors.length]=new o.default(n,e,t,b);if("function"==typeof g)this.colors.sort(g).reverse();else if(w)for(let t=this.colors.length-1;t>0;t--){const e=Math.floor(Math.random()*(t+1));[this.colors[t],this.colors[e]]=[this.colors[e],this.colors[t]]}}calculate(t,e,n,i,r){const o=[];for(const{index:e}of r)255===n[e+3]&&(o[o.length]=i.compare([n[e],n[e+1],n[e+2]],t));return{count:o.length-r.length+8,distance:e(o)}}async process(t,e,n,i){const{colors:r,context:o,interval:s,select:c}=this,u=[{pixel:t.memoized(this.focus[0],this.focus[1],this.width,this.height),count:0,distance:0}],l=o.createImageData(this.width,this.height),{data:a}=l,h=this.calculate.bind(this,this.weights,this.select,a),f=function(t,e,n,i){return 0===e[i.index+3]&&!t.some(n,i)}.bind(this,u,a,function(t){return this===t.pixel});let d=n.now();for(;r.length>0&&u.length>0;){const t=r.pop();let c=0;for(const e of u){const n=h(t,e.pixel.neighbors);c+=e.count=n.count,e.distance=n.distance}const p=this.priority||c/u.length;u.sort(e.bind(null,p));let g=0,w=u[0],m=1;for(const[t,e]of u.entries()){if(w.count<p)break;w.count<=e.count&&w.distance>=e.distance&&i()*m<1&&(w=e,g=t,m++)}const{index:y,x:b,y:x}=w.pixel;a[y]=t.r,a[y+1]=t.g,a[y+2]=t.b,a[y+3]=255;const v=w.pixel.neighbors.filter(f);u.splice(g,1);for(const t of v)u[u.length]={pixel:t,count:0,distance:0};o.putImageData(l,0,0,b,x,1,1),n.now()-d>=s&&(await o.commit(),d=n.now())}}}Object.defineProperties(a,{select:{configurable:!0,value:c.select,writable:!0},weights:{configurable:!0,value:c.weights,writable:!0}}),n.default=a}).call(this,t("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./color":1,"./pixel":3,"./utils":4,_process:6}],6:[function(t,e,n){function i(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function o(t){if(h===setTimeout)return setTimeout(t,0);if((h===i||!h)&&setTimeout)return h=setTimeout,setTimeout(t,0);try{return h(t,0)}catch(e){try{return h.call(null,t,0)}catch(e){return h.call(this,t,0)}}}function s(t){if(f===clearTimeout)return clearTimeout(t);if((f===r||!f)&&clearTimeout)return f=clearTimeout,clearTimeout(t);try{return f(t)}catch(e){try{return f.call(null,t)}catch(e){return f.call(this,t)}}}function c(){w&&p&&(w=!1,p.length?g=p.concat(g):m=-1,g.length&&u())}function u(){if(!w){var t=o(c);w=!0;for(var e=g.length;e;){for(p=g,g=[];++m<e;)p&&p[m].run();m=-1,e=g.length}p=null,w=!1,s(t)}}function l(t,e){this.fun=t,this.array=e}function a(){}var h,f,d=e.exports={};!function(){try{h="function"==typeof setTimeout?setTimeout:i}catch(t){h=i}try{f="function"==typeof clearTimeout?clearTimeout:r}catch(t){f=r}}();var p,g=[],w=!1,m=-1;d.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];g.push(new l(t,e)),1!==g.length||w||o(u)},l.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=a,d.addListener=a,d.once=a,d.off=a,d.removeListener=a,d.removeAllListeners=a,d.emit=a,d.prependListener=a,d.prependOnceListener=a,d.listeners=function(t){return[]},d.binding=function(t){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(t){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},{}]},{},[2])(2)});
//# sourceMappingURL=watercolor.min.js.map
