!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Watercolor=t()}}(function(){return function t(e,n,i){function r(a,s){if(!n[a]){if(!e[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[a]={exports:{}};e[a][0].call(l.exports,function(t){var n=e[a][1][t];return r(n||t)},l,l.exports,t,e,n,i)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<i.length;a++)r(i[a]);return r}({1:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});class i{constructor(t,e,n,i){const r=8-i,o=Math.max(0,1<<r-1);this.r=(t<<r)+o,this.g=(e<<r)+o,this.b=(n<<r)+o}compare([t,e,n],[i,r,o]=[1,1,1]){const{r:a,g:s,b:c}=this,u=(a-t)*i,l=(s-e)*r,h=(c-n)*o;return u*u+l*l+h*h}}n.default=i},{}],2:[function(t,e,n){"use strict";var i=function(t){return t&&t.__esModule?t:{default:t}}(t("./watercolor"));e.exports=i.default},{"./watercolor":5}],3:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});class i{static create(t,e,n,r){class o extends i{constructor(t,e){if(super(t,e),this.index>=0){if(this.cache.has(this.index))return this.cache.get(this.index);this.cache.set(this.index,this)}}}return Object.defineProperties(o.prototype,{cache:{configurable:!0,value:new Map,writable:!0},width:{configurable:!0,value:n,writable:!0},height:{configurable:!0,value:r,writable:!0}}),new o(t,e)}constructor(t,e){if(t<0||t>=this.width||e<0||e>=this.height)return this.x=-1,this.y=-1,void(this.index=-1);this.x=t,this.y=e,this.index=e*this.width+t<<2}get neighbors(){const{x:t,y:e,constructor:n}=this,i=[new n(t-1,e-1),new n(t,e-1),new n(t+1,e-1),new n(t-1,e),new n(t+1,e),new n(t-1,e+1),new n(t,e+1),new n(t+1,e+1)].filter(t=>t.index>=0);return Object.defineProperty(this,"neighbors",{configurable:!0,value:i,writable:!0}),i}}n.default=i},{}],4:[function(t,e,n){"use strict";function*i(t,e=25214903917,n=11,i=2**48-1){for(;;)t=(e*t+n)%i,yield Math.floor(t/65536)/2**32}Object.defineProperty(n,"__esModule",{value:!0}),n.lcg=i,n.default=function(t){const e=i(t);return function(){return this().value}.bind(e.next.bind(e))}},{}],5:[function(t,e,n){(function(e){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(n,"__esModule",{value:!0});var r=i(t("./color")),o=i(t("./pixel")),a=i(t("./random"));const s={min:Function.prototype.apply.bind(Math.min,Math),max:Function.prototype.apply.bind(Math.max,Math),average(t){let e=0;for(let n=t.length-1;n>=0;n--)e+=t[n];return e/t.length},median(t){t.sort((t,e)=>t-e);const e=t.length>>1;return t.length%2==1?t[e]:(t[e]+t[e-1])/2}},c={default:[1,1,1],natural:[2126,7152,722]};class u{static validateImageData(t,e="imageData",n=new TypeError(`${e} must be an instance of ImageData`)){if(!t)throw n;const i=Object(t);this.validateDimension(i.width,"imageData.width"),this.validateDimension(i.height,"imageData.height"),this.validateData(i.data,"imageData.data")}static validateDimension(t,e="dimension",n=new TypeError(`${e} must be a positive integer`)){if(t<=0||Math.floor(t)!==t)throw n}static validateData(t,e="data",n=new TypeError(`${e} must be an unsigned 8-bit integer array with a 4-byte alignment`)){if(t.length!==t.byteLength||t.length%4!=0||!/^Uint8/.test(t.constructor.name))throw n}static validateSeed(t,e="seed",n=new TypeError(`${e} must be a non-negative number`)){if(!(t>=0))throw n}constructor({canvas:t,context:e=t.getContext("2d"),width:n=e.canvas.width,height:i=e.canvas.height,imageData:r=e.getImageData(0,0,n,i),depth:o=Math.round(Math.log2(n*i)/3),priority:a=0,select:s="min",weights:c="default",focus:u=[50,50],seed:l=Date.now(),sort:h,shuffle:f=!1}={}){const d=this.constructor;d.validateImageData(r),d.validateSeed(l),this.context=e,this.imageData=r,this.width=n,this.height=i,this.depth=o,this.priority=a,this.select="function"==typeof s?s:d.select[s],this.weights=Array.isArray(c)?c:d.weights[c];const g=Math.min(Math.max(Math.round(u[0]*(n-1)/100),0),n-1),p=Math.min(Math.max(Math.round(u[1]*(i-1)/100),0),i-1);this.focus=[g,p],this.seed=l,this.sort=h,this.shuffle=f}get colors(){const{Color:t}=this.constructor,{depth:e,random:n,shuffle:i,sort:r}=this,o=[],a=1<<e;for(let n=0;n<a;n++)for(let i=0;i<a;i++)for(let r=0;r<a;r++)o[o.length]=new t(r,i,n,e);if("function"==typeof r)o.sort(r).reverse();else if(i)for(let t=o.length-1;t>0;t--){const e=Math.floor(n()*(t+1));[o[t],o[e]]=[o[e],o[t]]}return o}compare(t,e){return(e.count>=this)-(t.count>=this)||t.distance-e.distance}calculate(t,e,n,i,r){const o=r.pixel.neighbors,a=[];for(const{index:e}of o)255===t[e+3]&&(a[a.length]=i.compare([t[e],t[e+1],t[e+2]],n));r.count=a.length-o.length+8,r.distance=e(a)}async process(t=(()=>!1)){const e=this.constructor,n=this.random=e.random(this.seed),{colors:i,compare:r,context:o,imageData:a}=this,{data:s}=a,c=this.calculate.bind(null,s,this.select,this.weights),u=[{pixel:e.Pixel.create(this.focus[0],this.focus[1],this.width,this.height),count:0,distance:0}],l=function(t,e,n,i){return 0===e[i.index+3]&&!t.some(n,i)}.bind(null,u,s,function(t){return this===t.pixel});for(;i.length>0&&u.length>0;){const e=i.pop();let h=0;for(const t of u)c(e,t),h+=t.count;const f=this.priority||h/u.length;u.sort(r.bind(f));let d=0,g=u[d],p=1;for(const[t,e]of u.entries()){if(e.count<f||e.distance>g.distance)break;g.count<=e.count&&g.distance>=e.distance&&n()*p<1&&(d=t,g=e,p++)}const{index:m,x:w,y:b,neighbors:y}=g.pixel;s[m]=e.r,s[m+1]=e.g,s[m+2]=e.b,s[m+3]=255,u.splice(d,1);for(const t of y.filter(l))u[u.length]={pixel:t,count:0,distance:0};o.putImageData(a,0,0,w,b,1,1),t()&&await o.commit()}await o.commit()}}Object.defineProperties(u,{Color:{configurable:!0,value:r.default,writable:!0},Pixel:{configurable:!0,value:o.default,writable:!0},random:{configurable:!0,value:a.default,writable:!0},select:{configurable:!0,value:s,writable:!0},weights:{configurable:!0,value:c,writable:!0}}),n.default=u}).call(this,t("_process"))},{"./color":1,"./pixel":3,"./random":4,_process:6}],6:[function(t,e,n){function i(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function o(t){if(h===setTimeout)return setTimeout(t,0);if((h===i||!h)&&setTimeout)return h=setTimeout,setTimeout(t,0);try{return h(t,0)}catch(e){try{return h.call(null,t,0)}catch(e){return h.call(this,t,0)}}}function a(t){if(f===clearTimeout)return clearTimeout(t);if((f===r||!f)&&clearTimeout)return f=clearTimeout,clearTimeout(t);try{return f(t)}catch(e){try{return f.call(null,t)}catch(e){return f.call(this,t)}}}function s(){m&&g&&(m=!1,g.length?p=g.concat(p):w=-1,p.length&&c())}function c(){if(!m){var t=o(s);m=!0;for(var e=p.length;e;){for(g=p,p=[];++w<e;)g&&g[w].run();w=-1,e=p.length}g=null,m=!1,a(t)}}function u(t,e){this.fun=t,this.array=e}function l(){}var h,f,d=e.exports={};!function(){try{h="function"==typeof setTimeout?setTimeout:i}catch(t){h=i}try{f="function"==typeof clearTimeout?clearTimeout:r}catch(t){f=r}}();var g,p=[],m=!1,w=-1;d.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];p.push(new u(t,e)),1!==p.length||m||o(c)},u.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=l,d.addListener=l,d.once=l,d.off=l,d.removeListener=l,d.removeAllListeners=l,d.emit=l,d.prependListener=l,d.prependOnceListener=l,d.listeners=function(t){return[]},d.binding=function(t){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(t){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},{}]},{},[2])(2)});
//# sourceMappingURL=watercolor.min.js.map
