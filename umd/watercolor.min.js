!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Watercolor=t()}}(function(){return function t(e,n,i){function r(s,c){if(!n[s]){if(!e[s]){var u="function"==typeof require&&require;if(!c&&u)return u(s,!0);if(o)return o(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var a=n[s]={exports:{}};e[s][0].call(a.exports,function(t){var n=e[s][1][t];return r(n||t)},a,a.exports,t,e,n,i)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)r(i[s]);return r}({1:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});class i{constructor(t,e,n,i){const r=8-i,o=Math.max(0,1<<r-1);this.r=(t<<r)+o,this.g=(e<<r)+o,this.b=(n<<r)+o}compare([t,e,n],[i,r,o]=[1,1,1]){const{r:s,g:c,b:u}=this,l=(s-t)*i,a=(c-e)*r,h=(u-n)*o;return l*l+a*a+h*h}}n.default=i},{}],2:[function(t,e,n){"use strict";var i=function(t){return t&&t.__esModule?t:{default:t}}(t("./watercolor"));e.exports=i.default},{"./watercolor":5}],3:[function(t,e,n){"use strict";function*i(t,e=25214903917,n=11,i=2**48-1){for(;;)t=(e*t+n)%i,yield Math.floor(t/65536)/2**32}Object.defineProperty(n,"__esModule",{value:!0}),n.lcg=i,n.default=function(t){const e=i(t);return function(){return this().value}.bind(e.next.bind(e))}},{}],4:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});class i{static memoized(t,e,n,r){class o extends i{constructor(t,e){if(super(t,e),this.index>=0){if(this.cache.has(this.index))return this.cache.get(this.index);this.cache.set(this.index,this)}}}return Object.defineProperties(o.prototype,{cache:{configurable:!0,value:new Map,writable:!0},width:{configurable:!0,value:n,writable:!0},height:{configurable:!0,value:r,writable:!0}}),new o(t,e)}constructor(t,e){if(t<0||t>=this.width||e<0||e>=this.height)return this.x=-1,this.y=-1,void(this.index=-1);this.x=t,this.y=e,this.index=e*this.width+t<<2}get neighbors(){const{x:t,y:e,constructor:n}=this,i=[new n(t-1,e-1),new n(t,e-1),new n(t+1,e-1),new n(t-1,e),new n(t+1,e),new n(t-1,e+1),new n(t,e+1),new n(t+1,e+1)].filter(t=>t.index>=0);return Object.defineProperty(this,"neighbors",{configurable:!0,value:i,writable:!0}),i}}n.default=i},{}],5:[function(t,e,n){(function(e,i){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e,n){return(n.count>=t)-(e.count>=t)||e.distance-n.distance}Object.defineProperty(n,"__esModule",{value:!0});var s=r(t("./color")),c=r(t("./pixel")),u=r(t("./lcg"));const l={min:Function.prototype.apply.bind(Math.min,Math),max:Function.prototype.apply.bind(Math.max,Math),average(t){let e=0;for(let n=t.length-1;n>=0;n--)e+=t[n];return e/t.length},median(t){t.sort((t,e)=>t-e);const e=t.length>>1;return t.length%2==1?t[e]:(t[e]+t[e-1])/2}},a={default:[1,1,1],natural:[2126,7152,722]},{OffscreenCanvas:h,performance:f}=i;class d{constructor({canvas:t,width:e=t.width,height:n=t.height,depth:i=Math.round(Math.log2(e*n)/3),priority:r=0,select:l=d.select.min,weights:a=d.weights.default,focus:p=[50,50],interval:g=1e3,sort:w,shuffle:m=!1,seed:b=Date.now()}={}){if(!(t instanceof h))throw new TypeError("canvas must be instance of OffscreenCanvas");if(isNaN(b))throw new TypeError("seed must be a number");this.width=t.width=e,this.height=t.height=n,this.priority=r,this.select="function"==typeof l?l:d.select[l],this.weights=Array.isArray(a)?a:d.weights[a];const y=Math.min(Math.max(Math.round(p[0]*(e-1)/100),0),e-1),x=Math.min(Math.max(Math.round(p[1]*(n-1)/100),0),n-1);this.focus=[y,x],this.interval=g,this.context=t.getContext("2d"),this.colors=[];const v=(0,u.default)(b);this.process=this.process.bind(this,c.default,o,f,v);const M=i,T=1<<M;for(let t=0;t<T;t++)for(let e=0;e<T;e++)for(let n=0;n<T;n++)this.colors[this.colors.length]=new s.default(n,e,t,M);if("function"==typeof w)this.colors.sort(w).reverse();else if(m)for(let t=this.colors.length-1;t>0;t--){const e=Math.floor(v()*(t+1));[this.colors[t],this.colors[e]]=[this.colors[e],this.colors[t]]}}calculate(t,e,n,i,r){const o=[];for(const{index:e}of r)255===n[e+3]&&(o[o.length]=i.compare([n[e],n[e+1],n[e+2]],t));return{count:o.length-r.length+8,distance:e(o)}}async process(t,e,n,i){const{colors:r,context:o,interval:s}=this,c=[{pixel:t.memoized(this.focus[0],this.focus[1],this.width,this.height),count:0,distance:0}],u=o.createImageData(this.width,this.height),{data:l}=u,a=this.calculate.bind(this,this.weights,this.select,l),h=function(t,e,n,i){return 0===e[i.index+3]&&!t.some(n,i)}.bind(this,c,l,function(t){return this===t.pixel});let f=n.now();for(;r.length>0&&c.length>0;){const t=r.pop();let d=0;for(const e of c){const n=a(t,e.pixel.neighbors);d+=e.count=n.count,e.distance=n.distance}const p=this.priority||d/c.length;c.sort(e.bind(null,p));let g=0,w=c[0],m=1;for(const[t,e]of c.entries()){if(w.count<p)break;w.count<=e.count&&w.distance>=e.distance&&i()*m<1&&(w=e,g=t,m++)}const{index:b,x:y,y:x}=w.pixel;l[b]=t.r,l[b+1]=t.g,l[b+2]=t.b,l[b+3]=255;const v=w.pixel.neighbors.filter(h);c.splice(g,1);for(const t of v)c[c.length]={pixel:t,count:0,distance:0};o.putImageData(u,0,0,y,x,1,1),n.now()-f>=s&&(await o.commit(),f=n.now())}}}Object.defineProperties(d,{select:{configurable:!0,value:l,writable:!0},weights:{configurable:!0,value:a,writable:!0}}),n.default=d}).call(this,t("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./color":1,"./lcg":3,"./pixel":4,_process:6}],6:[function(t,e,n){function i(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function o(t){if(h===setTimeout)return setTimeout(t,0);if((h===i||!h)&&setTimeout)return h=setTimeout,setTimeout(t,0);try{return h(t,0)}catch(e){try{return h.call(null,t,0)}catch(e){return h.call(this,t,0)}}}function s(t){if(f===clearTimeout)return clearTimeout(t);if((f===r||!f)&&clearTimeout)return f=clearTimeout,clearTimeout(t);try{return f(t)}catch(e){try{return f.call(null,t)}catch(e){return f.call(this,t)}}}function c(){w&&p&&(w=!1,p.length?g=p.concat(g):m=-1,g.length&&u())}function u(){if(!w){var t=o(c);w=!0;for(var e=g.length;e;){for(p=g,g=[];++m<e;)p&&p[m].run();m=-1,e=g.length}p=null,w=!1,s(t)}}function l(t,e){this.fun=t,this.array=e}function a(){}var h,f,d=e.exports={};!function(){try{h="function"==typeof setTimeout?setTimeout:i}catch(t){h=i}try{f="function"==typeof clearTimeout?clearTimeout:r}catch(t){f=r}}();var p,g=[],w=!1,m=-1;d.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];g.push(new l(t,e)),1!==g.length||w||o(u)},l.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=a,d.addListener=a,d.once=a,d.off=a,d.removeListener=a,d.removeAllListeners=a,d.emit=a,d.prependListener=a,d.prependOnceListener=a,d.listeners=function(t){return[]},d.binding=function(t){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(t){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},{}]},{},[2])(2)});
//# sourceMappingURL=watercolor.min.js.map
